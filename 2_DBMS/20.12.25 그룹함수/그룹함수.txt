2020-12-28 ⓚ금경용

그룹함수란 여러 행 또는 테이블 전체의 행에 대해 함수가 적용되어 하나의 결과값을 가져오는 함수를 말한다.
	 GROUP BY절을 이용하여 그룹 당 하나의 결과가 주어지도록 그룹화할 수 있다.
	 HAVING절을 사용하여 그룹 함수를 가지고 조건 비교를 할 수 있다.
	 COUNT(*)를 제외한 모든 그룹함수는 NULL값을 고려하지 않는다
	 MIN, MAX 그룹함수는 모든 자료형에 대해서 사용할 수 있다.

1.그룹함수 ; 하나 이상의 행을 그룹으로 묶어 연산하여 총합, 평균 등 하나의 결과로 나타냄
	(1)SUM : 그룹의 누적 합계
	(2)AVG : 그룹의 평균
	(3)COUNT : 그룹의 총 개수
	(4)MAX : 그룹의 최대값
	(5)MIN : 그룹의 최소값
	(6)STDDEV : 그룹의 표준편차
	(7)VARIANCE : 그룹의 분산

★GROUP BY 절
	(1)그룹함수를 쓰되 어떤 컬럼 값을 기준으로 그룹함수를 적용할 경우 GROUP BY 절 뒤에 해당 컬럼을 기술하면 됩니다
	(2)형식 : SELECT 컬럼명, 그룹함수
      		 FROM 테이블명 
       		WHERE 조건(연산자)
       		GROUP BY 컬럼명;
	(3)합계, 평균, 최대값이나 최소값 등을 어떤 칼럼을 기준으로 그 칼럼의 값 별로 보고자 할 때 
	(4)GROUP BY 절을 사용할 때 주의할 점은 GROUP BY 절 다음에는 칼럼의 별칭을 사용할 수 없고, 반드시 칼럼명을 기술해야 한다는 점.
	ex)SELECT DEPTNO 부서, MAX(SAL), MIN(SAL) FROM EMP GROUP BY DEPTNO ORDER BY 부서;

	※ROLLUP 연산자와 함께 GROUP BY 절 사용
              ※복수개의 컬럼에 대한 ROLLUP
              ※ROLLUP을 이용한 또 다른 집합 함수 ; 합이 아닌 평균도 가능 	
		EX)­SELECT deptno, job, avg(sal) FROM emp GROUP BY ROLLUP(deptno, job);	

★HAVING 조건
SELECT column, group_function
	FROM table
	[WHERE condition]
	[GROUP BY group_by_expression]
	[HAVING   group_condition]
	[ORDER BY column] ;

              Ex)부서별로 그룹 은 후(GROUP BY), 그룹 지어진 부서별 평균 급여가 2000이상인(HAVING) 부서번호와 
	부서별 평균 급여를 출력하는 경우 다음과 같이 HAVING을 이용한다
	SELECT DEPTNO, AVG(SAL) FROM EMP GROUP BY DEPTNO HAVING AVG(SAL)>=2000;.

★피벗 테이블
피벗 테이블 이용한 예
SELECT deptno, SUM(DECODE(job, 'CLERK', sal,0)) CLERK,
               SUM(DECODE(job, 'MANAGER', sal,0)) MANAGER,
               SUM(DECODE(job, 'PRESIDENT', sal,0)) PRESIDENT,
               SUM(DECODE(job, 'ANALYST', sal,0)) ANALYST,
               SUM(DECODE(job, 'SALESMAN', sal,0)) SALESMAN,
               SUM(sal) "소계"
  FROM EMP GROUP BY ROLLUP(deptno);

